@using System.Globalization;
@model Railway_Group01.Models.ViewModels.RailwaySearchModel;
@{
    ViewData["Title"] = "Search";
    Layout = "~/Views/Shared/_LayoutofTuong.cshtml";
    var now = DateTime.Now;
    var tenMoreDays = now.AddDays(10);
    var nowString = now.ToString("yyyy-MM-dd");
    var tenMoreDaysString = tenMoreDays.ToString("yyyy-MM-dd");
}

<div class="bg-gradient-cus">
    <div class="form-fields">
        <form class="row g-1 ui form w-lg-50  w-md-100 mx-auto" method="get">
            <div class="col-sm-2 col-4  field">
                <label for="gaDi" class="form-label text-white-50 fw-500" style="font-size:12px">From</label>
                <select id="gaDi" class="form-select" name="From" asp-items="ViewBag.FromStationSelectList"
                        style="border-bottom:solid 1px white; border-top:0; border-left:0; border-right:0;"></select>
            </div>
            <div class="col-sm-2 col-4">
                <label for="gaDen" class="form-label text-white-50 fw-500" style="font-size:12px">To</label>
                <select id="gaDen" class="form-select" name="To" asp-items="ViewBag.ToStationSelectList"
                        style="border-bottom:solid 1px white; border-top:0; border-left:0; border-right:0"></select>
            </div>
            <div class="col-sm-2">
                <label for="ngayXP" class="form-label text-white-50 fw-500" style="font-size:12px">Date</label>
                <input type="date" class="form-control" id="ngayXP" asp-for="@Model.StartDate" min="@nowString" max="@tenMoreDaysString"
                    style="border-bottom:solid 1px white; border-top:0; border-left:0; border-right:0;" />
            </div>
            <div class="d-flex flex-row justify-content-center align-items-center col-sm-2">
                <button type="submit" class=" text-uppercase btn btn-orange" style="width:120px">
                    Search
                </button>
            </div>
        </form>
    </div>
</div>

<div class="container-fluid pt-4 pb-3 mb-3 shadow">
    <div class="row">
        <div class="d-flex flex-row col-10 mx-auto">
            <div class="w-25" style="border-right:1px dashed rgba(0,0,0,.12)">
                <div class="mb-2">Class</div>
                <div class="d-inline-flex p-2">
                    <div class="d-flex flex-row flex-wrap">
                        @foreach (var c in @ViewBag.ClassList)
                        {
                            <div class="form-check form-check-inline ">
                                <input type="checkbox" class="form-check-input" id="@c.Code" name="@c.Name" />
                                <label class="form-check-label" for="@c.Code">@c.Name</label>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="w-25 ps-4" style="border-right:1px dashed rgba(0,0,0,.12)">
                <div>
                    <div class="mb-2">Quota</div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                            <label class="form-check-label" for="flexRadioDefault1">
                                Default radio
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                            <label class="form-check-label" for="flexRadioDefault1">
                                Default radio
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                            <label class="form-check-label" for="flexRadioDefault1">
                                Default radio
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-25 ps-4">
                <div class="mb-2">Departure from</div>
                <div class=" d-flex flex-row flex-wrap">
                    <input type="checkbox" class="btn-check" id="btn-check-1" autocomplete="off">
                    <label class="btn btn-outline-primary mb-2 me-2" for="btn-check-1">00:00 - 06:00</label>
                    <input type="checkbox" class="btn-check" id="btn-check-2" autocomplete="off">
                    <label class="btn btn-outline-primary mb-2 me-2" for="btn-check-2">06:00 - 12:00</label>
                    <input type="checkbox" class="btn-check" id="btn-check-3" autocomplete="off">
                    <label class="btn btn-outline-primary mb-2 me-2" for="btn-check-3">12:00 - 18:00</label>
                    <input type="checkbox" class="btn-check" id="btn-check-4" autocomplete="off">
                    <label class="btn btn-outline-primary mb-2 me-2" for="btn-check-4">18:00 - 24:00</label>
                </div>
            </div>
            <div class="w-25 ps-4">
                <button class="btn btn-orange px-5 fw-800 rounded-0">Filter</button>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="row">
        <div class="col-lg-8 col-md-12 mx-auto">
            <div>
                <div id="carouselExampleFade" class="carousel slide carousel-fade ">
                    <div class="carousel-inner py-2">
                        <div class="carousel-item active d-flex flex-row justify-content-around align-items-center p-2">
                            <div class="card">
                                <div class="card-body p-2">
                                    Sun, 17
                                    Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span>
                                        <span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Mon, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Tue, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Wed, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Thu, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Fri, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Sat, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="carousel-item d-flex flex-row justify-content-around align-items-center p-2">
                            <div class="card">
                                <div class="card-body p-2">
                                    Sun, 17
                                    Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span>
                                        <span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Mon, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Tue, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Wed, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Thu, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Fri, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card ">
                                <div class="card-body p-2">
                                    Sat, 18 Nov
                                    <div id="title" style="color: rgb(221, 55, 52);">
                                        <span class="slash"
                                              style="color: rgb(221, 55, 52);"></span><span class="slash-title">Few Seats</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <button class="position-absolute top-50 start-0 translate-middle border-0 bg-white" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="prev">
                        <img src="~/images/svg/chevron-compact-left.svg" />
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="position-absolute  top-50 start-100 translate-middle border-0 bg-white" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="next">
                        <img src="~/images/svg/chevron-compact-right.svg" />
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
            @if (Model.Schedules != null && Model.Schedules.Any())
            {
                @foreach (var schedule in Model.Schedules)
                {
                    <div class="mt-4">
                        <div class="card p-2">
                            <div class="card-body">
                                <div class="d-inline-flex w-100">
                                    <div class="p-3 w-25">
                                        <div class="">
                                            <a href="" class="h5" style="color: rgb(236, 88, 36); text-decoration: none;">
                                                <span class="">@schedule.Name</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="w-75">
                                        <div class="row w-md-50">
                                            <div class="col-3 col-lg-2 mx-auto me-0">
                                                <div class="">
                                                    <a class="text-decoration-none fw-bold" style="color: rgb(236, 88, 36);" href="">@schedule.Route.RouteDetails.First().DepartureStation.Name</a>
                                                    <div class="c-tooltip bottom">
                                                        <div class="tip"></div>
                                                    </div>
                                                </div>
                                                <div class="time">@schedule.Departure.ToString("hh:mm tt")</div>
                                                <div class="date">@schedule.Departure.ToString("ddd, dd MMM")</div>
                                            </div>
                                            <div class="col-3 d-flex flex-column align-items-center ">
                                                <div class="text-center">
                                                        @{
                                                            var time = schedule.Arrival - schedule.Departure;
                                                        }
                                                        @time.Hours h @time.Minutes mins
                                                 </div>
                                                 <img src="~/images/svg/Icon_train.svg.png" width="50px" />
                                            </div>
                                            <div class="col-3 col-lg-2 mx-auto ms-0">
                                                <div class="">
                                                    <a class="text-decoration-none fw-bold" style="color: rgb(236, 88, 36);" href="">@schedule.Route.RouteDetails.Last().ArrivalStation.Name</a>
                                                    <div class="c-tooltip bottom">
                                                        <div class="tip"></div>
                                                    </div>
                                                </div>
                                                <div class="time">@schedule.Arrival.ToString("hh:mm tt")</div>
                                                <div class="date">@schedule.Arrival.ToString("ddd, dd MMM")</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class=" d-flex flex-row justify-content-around align-items-center my-4 multiple-class">
                                    @if (schedule.Train!.Coaches!.Any())
                                    {
                                        int classCount = 1;
                                        @foreach (var coach in schedule.Train!.Coaches!)
                                        {
                                            <a role="button" class="text-decoration-none text-black train-coach" data-bs-toggle="collapse" href="#@schedule.TrainCode-@coach.Id" aria-expanded="false" aria-controls="@schedule.TrainCode-@coach.Id" >
                                                <div class="card" style="width:180px">
                                                    <div class="card-body d-flex flex-column  p-2">
                                                        <div class="fs-6 text-center" style="color: #EC5B24;">Coach @classCount</div>
                                                        <div>Last: @Html.DisplayFor(x=>coach.NoOfSeats)</div>
                                                    </div>
                                                </div>
                                            </a>
                                            classCount++;
                                        }
                                    }
                                </div>
                                @{
                                    int coachCount = 1;
                                }
                                @foreach (var coach in schedule.Train.Coaches)
                                {
                                    <div class="collapse " id="@schedule.TrainCode-@coach.Id">
                                        <div class="d-flex flex-row align-items-center justify-content-center pt-3">
                                            @if (coach.NoOfCompartments == 0)
                                            {
                                                int count = 1;
                                                <div class="row et-car-floor ">
                                                    <div class="et-full-width">
                                                        @while (count <= coach.NoOfSeats)
                                                        {
                                                            <div class="et-car-nm-64-sit ng-isolate-scope">
                                                                <div class="et-car-seat-left et-seat-h-35">
                                                                    <div class="et-col-16 et-sit-side"></div>
                                                                    <div class="et-col-84 et-sit-sur-outer">
                                                                        <div class="et-sit-sur text-center et-sit-avaiable">
                                                                            <div data-bs-toggle="tooltip" data-bs-title="Available seat" data-bs-placement="top" data-bs-custom-class="custom-tooltip" class="et-sit-no sit-available" 
                                                                                data-schedule="@schedule.Id" 
                                                                                data-coach="@coach.Id" 
                                                                                data-seat="@count" 
                                                                                data-start="@schedule.Departure" 
                                                                                data-end="@schedule.Arrival" 
                                                                                data-cabin="0" 
                                                                                data-coachCount="@coachCount"
                                                                                 data-fromStation="@schedule.Route.RouteDetails.First().DepartureStationId"
                                                                                 data-toStation="@schedule.Route.RouteDetails.Last().ArrivalStationId">
                                                                                <span>@count</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            count++;
                                                        }
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                int count = 1;
                                                int cabinNum = 1;
                                                <div class="row et-car-floor w-100">
                                                    <div class="et-col-1-18 et-car-floor-full-height"></div>
                                                    <div class="et-col-8-9">
                                                        <div class="et-bed-way et-full-width et-text-sm">
                                                            @for (int i = 1; i <= 8; i++)
                                                            {
                                                                @if (coach.NoOfCompartments < i)
                                                                {
                                                                    <div class="et-col-1-8 text-center ng-binding et-hidden">Cabin @i</div>
                                                                }
                                                                else
                                                                {
                                                                    <div class="et-col-1-8 text-center ng-binding">Cabin @i</div>
                                                                }
                                                            }
                                                        </div>
                                                        @{
                                                            int brek = coach.NoOfCompartments * 2;
                                                        }
                                                        @while (count <= coach.NoOfSeats)
                                                        {
                                                            if (brek == 0)
                                                            {
                                                                <div class="et-col-1-16 et-seat-h-35 ng-isolate-scope ">
                                                                    <div class="et-bed-right invisible">
                                                                    </div>
                                                                </div>
                                                                <div class="et-col-1-16 et-seat-h-35 ng-isolate-scope">
                                                                    <div class="et-bed-left invisible">
                                                                    </div>
                                                                </div>
                                                                brek = coach.NoOfCompartments * 2;
                                                                cabinNum = 0;
                                                            }
                                                            if (count % 2 == 0)
                                                            {
                                                                <div class="et-col-1-16 et-seat-h-35 ng-isolate-scope ">
                                                                    <div class="et-bed-right">
                                                                        <div class="et-bed-outer">
                                                                            <div class="et-bed text-center et-sit-avaiable">
                                                                                <div data-bs-toggle="tooltip" data-bs-title="Available seat" data-bs-custom-class="custom-tooltip" data-bs-placement="top" class="et-sit-no sit-available" 
                                                                                    data-schedule="@schedule.Id" 
                                                                                    data-cabin="@cabinNum" 
                                                                                    data-coach="@coach.Id" 
                                                                                    data-seat="@count" 
                                                                                    data-start="@schedule.Departure" 
                                                                                    data-end="@schedule.Arrival" 
                                                                                    data-coachCount="@coachCount"
                                                                                     data-fromStation="@schedule.Route.RouteDetails.First().DepartureStationId"
                                                                                     data-toStation="@schedule.Route.RouteDetails.Last().ArrivalStationId">
                                                                                    <span>@count</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="et-bed-illu"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            }
                                                            else
                                                            {
                                                                <div class="et-col-1-16 et-seat-h-35 ng-isolate-scope">
                                                                    <div class="et-bed-left ">
                                                                        <div class="et-bed-outer">
                                                                            <div class="et-bed text-center et-sit-avaiable">
                                                                                <div data-bs-toggle="tooltip" data-bs-title="Available seat" data-bs-custom-class="custom-tooltip" data-bs-placement="top" class="et-sit-no sit-available" 
                                                                                    data-schedule="@schedule.Id" 
                                                                                    data-cabin="@cabinNum" 
                                                                                    data-coach="@coach.Id" 
                                                                                    data-seat="@count" 
                                                                                    data-start="@schedule.Departure" 
                                                                                    data-end="@schedule.Arrival" 
                                                                                    data-coachCount="@coachCount"
                                                                                     data-fromStation="@schedule.Route.RouteDetails.First().DepartureStationId"
                                                                                     data-toStation="@schedule.Route.RouteDetails.Last().ArrivalStationId">
                                                                                    <span>@count</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="et-bed-illu"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            }
                                                            cabinNum++;
                                                            brek--;
                                                            count++;
                                                        }
                                                    </div>
                                                    <div class="et-col-1-18 et-car-floor-full-height"></div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    coachCount++;
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <div class="col-lg-3 position-relative mt-3 mb-5">
        </div>
    </div>
</div>
